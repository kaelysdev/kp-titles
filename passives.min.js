var jsonSave,totalCount,isAdultKey="kp-passive-is-adult",saveKey="kp-passive-save";function isAdult(){window.localStorage.getItem(isAdultKey)||new bootstrap.Modal(document.getElementById("adultModal")).show()}function isAdultConfirmed(){window.localStorage.setItem(isAdultKey,!0)}function prepareSave(){var e=window.localStorage.getItem(saveKey);jsonSave=e?JSON.parse(e):{}}function save(){save&&window.localStorage.setItem(saveKey,JSON.stringify(jsonSave))}function filter(){var e=$(this).prop("id");if(e&&"search"!==e&&$(`.filter:not(#${e})`).prop("checked",!1),$("tbody").show(),$("table").unmark(),$(".filter:checked").length>0){var t=$(".filter:checked").val().toString().split(",");$("tbody").filter((function(){let e=$(this).data("categories").toString().split(",");return!e||!t.some((t=>e.includes(t)))})).hide()}var a=$("#search").val();if(a&&a.length>=3){var i=a.toLowerCase();$("table").mark(i),$("tbody:visible").filter((function(){var e=$(this).find(".search-name").text().toLowerCase(),t=$(this).find(".search-description").text().toLowerCase();return!e.includes(i)&&!t.includes(i)})).hide()}updateCount()}function claimed(){var e=$(this).prop("id").replace("claimed","");$(this).is(":checked")?($(this).parent().parent().parent().addClass("claimed-bg"),jsonSave[e]=!0,save()):($(this).parent().parent().parent().removeClass("claimed-bg"),jsonSave[e]=!1,save()),updateCount()}function claimedOptionDormantDesire(){var e=$(this).prop("id").replace("claimedOptionDormantDesire",""),t=$(`.claimed-option-dormant-desire:not(#${$(this).prop("id")})`),a=[];$.each(t,(function(e,t){a.push($(t).prop("id").replace("claimedOptionDormantDesire",""))})),t.prop("checked",!1).parent().parent().parent().removeClass("claimed-bg").addClass("unclaimable-bg"),$(this).parent().parent().parent().removeClass("unclaimable-bg").addClass("claimed-bg"),jsonSave[e]=!0,$.each(a,(function(e,t){jsonSave[t]=!1})),save(),updateCount()}function claimedOptionExtraSensitiveArea(){var e=$(this).prop("id").replace("claimedOptionExtraSensitiveArea",""),t=$(`.claimed-option-extra-sensisitve-area:not(#${$(this).prop("id")})`),a=[];$.each(t,(function(e,t){a.push($(t).prop("id").replace("claimedOptionExtraSensitiveArea",""))})),t.prop("checked",!1).parent().parent().parent().removeClass("claimed-bg").addClass("unclaimable-bg"),$(this).parent().parent().parent().removeClass("unclaimable-bg").addClass("claimed-bg"),jsonSave[e]=!0,$.each(a,(function(e,t){jsonSave[t]=!1})),save(),updateCount()}function updateCount(){let e=$(".claimed:visible:checked, .claimed-option:visible:checked").length,t=$("tbody:visible").length;$("#filteredClaimedCount").text(e),$("#filteredCount").text(t),t<totalCount?$("#filteredCount").addClass("orange"):$("#filteredCount").removeClass("orange")}function initClaimed(){var e=!1;if($.each($(".claimed-td"),(function(t,a){$(this).parent().parent().removeClass("claimed-bg");var i=$(this).data("id");if(i>=980&&i<=987){var n=$(this).find("input");if(jsonSave)jsonSave[i]&&$(n).prop("checked",!0);n.is(":checked")&&($(this).parent().parent().addClass("claimed-bg"),e=!0)}if(i>=988&&i<=997){n=$(this).find("input");if(jsonSave)jsonSave[i]&&$(n).prop("checked",!0);n.is(":checked")&&($(this).parent().parent().addClass("claimed-bg"),e=!0)}else{var d=$(this).find("input");if(jsonSave)jsonSave[i]&&$(d).prop("checked",!0);d.is(":checked")&&$(this).parent().parent().addClass("claimed-bg")}})),e)$(".claimed-option:not(:checked)").parent().parent().parent().addClass("unclaimable-bg")}function initTable(){$.each(passives,(function(e,t){var a=`\n            <tbody data-categories="${t.categories?t.categories.toString():""}">\n                <tr>`;t.id>=980&&t.id<=987?a+=`\n                    <td rowspan="2" class="align-middle text-center border-bottom-td claimed-td" style="min-width: 45px; width: 45px;" data-id="${t.id}">\n                        <input class="form-check-input claimed-option claimed-option-dormant-desire" type="radio" name="optionDormantDesire" value="" id="claimedOptionDormantDesire${t.id}">\n                    </td>`:t.id>=988&&t.id<=997?a+=`\n                    <td rowspan="2" class="align-middle text-center border-bottom-td claimed-td" style="min-width: 45px; width: 45px;" data-id="${t.id}">\n                        <input class="form-check-input claimed-option claimed-option-extra-sensisitve-area" type="radio" name="optionExtraSensitiveArea" value="" id="claimedOptionExtraSensitiveArea${t.id}">\n                    </td>`:a+=`\n                    <td rowspan="2" class="align-middle text-center border-bottom-td claimed-td" style="min-width: 45px; width: 45px;" data-id="${t.id}">\n                        <input class="form-check-input claimed" type="checkbox" value="" id="claimed${t.id}"${2===t.id||3===t.id?" checked disabled":""}>\n                    </td>`,a+=`\n                    <td rowspan="2" class="align-middle text-center border-bottom-td">${t.id}</td>\n                    <td class="passive-name search-name">${t.name}</td>\n                </tr>\n                <tr class="active-tr border-bottom-tr">\n                    <td class="search" colspan="2">\n                        <div class="search-description">${t.description}</div>`;var i="";$.each(t.effects,(function(e,t){e>0&&(i+='<span class="ms-4">'),i+=t,e>0&&(i+="</span>")})),a+=i,a+="\n                    </td>\n                </tr>\n            </tbody>",$("#passives").append(a)}))}$((function(){isAdult(),initTable(),prepareSave(),initClaimed(),$(".filter").prop("checked",!1),$("#search").val(""),totalCount=passives.length,$("#totalCount").text(totalCount),updateCount(),$(document).on("change",".filter",filter),$(document).on("input propertychange paste","#search",filter),$(document).on("click",".clear-search",(function(){$("#search").val("").focus(),filter()})),$(document).on("change",".claimed",claimed),$(document).on("change",".claimed-option-dormant-desire",claimedOptionDormantDesire),$(document).on("change",".claimed-option-extra-sensisitve-area",claimedOptionExtraSensitiveArea)}));